import{g as T,u as x,j as B,v as H,E as R,_ as E,r as p,o as c,c as _,a as w,b as i,w as d,F as C,f as y,i as g,k as b,d as D}from"./index-Bz4gLD2G.js";import{M as j}from"./index-BMSQkwth.js";import{g as U,p as I}from"./connect-x-tvTqis.js";class u{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(n,l=!1){return this.onePassHasher.start().appendStr(n).end(l)}static hashAsciiStr(n,l=!1){return this.onePassHasher.start().appendAsciiStr(n).end(l)}static _hex(n){const l=u.hexChars,a=u.hexOut;let e,t,o,h;for(h=0;h<4;h+=1)for(t=h*8,e=n[h],o=0;o<8;o+=2)a[t+1+o]=l.charAt(e&15),e>>>=4,a[t+0+o]=l.charAt(e&15),e>>>=4;return a.join("")}static _md5cycle(n,l){let a=n[0],e=n[1],t=n[2],o=n[3];a+=(e&t|~e&o)+l[0]-680876936|0,a=(a<<7|a>>>25)+e|0,o+=(a&e|~a&t)+l[1]-389564586|0,o=(o<<12|o>>>20)+a|0,t+=(o&a|~o&e)+l[2]+606105819|0,t=(t<<17|t>>>15)+o|0,e+=(t&o|~t&a)+l[3]-1044525330|0,e=(e<<22|e>>>10)+t|0,a+=(e&t|~e&o)+l[4]-176418897|0,a=(a<<7|a>>>25)+e|0,o+=(a&e|~a&t)+l[5]+1200080426|0,o=(o<<12|o>>>20)+a|0,t+=(o&a|~o&e)+l[6]-1473231341|0,t=(t<<17|t>>>15)+o|0,e+=(t&o|~t&a)+l[7]-45705983|0,e=(e<<22|e>>>10)+t|0,a+=(e&t|~e&o)+l[8]+1770035416|0,a=(a<<7|a>>>25)+e|0,o+=(a&e|~a&t)+l[9]-1958414417|0,o=(o<<12|o>>>20)+a|0,t+=(o&a|~o&e)+l[10]-42063|0,t=(t<<17|t>>>15)+o|0,e+=(t&o|~t&a)+l[11]-1990404162|0,e=(e<<22|e>>>10)+t|0,a+=(e&t|~e&o)+l[12]+1804603682|0,a=(a<<7|a>>>25)+e|0,o+=(a&e|~a&t)+l[13]-40341101|0,o=(o<<12|o>>>20)+a|0,t+=(o&a|~o&e)+l[14]-1502002290|0,t=(t<<17|t>>>15)+o|0,e+=(t&o|~t&a)+l[15]+1236535329|0,e=(e<<22|e>>>10)+t|0,a+=(e&o|t&~o)+l[1]-165796510|0,a=(a<<5|a>>>27)+e|0,o+=(a&t|e&~t)+l[6]-1069501632|0,o=(o<<9|o>>>23)+a|0,t+=(o&e|a&~e)+l[11]+643717713|0,t=(t<<14|t>>>18)+o|0,e+=(t&a|o&~a)+l[0]-373897302|0,e=(e<<20|e>>>12)+t|0,a+=(e&o|t&~o)+l[5]-701558691|0,a=(a<<5|a>>>27)+e|0,o+=(a&t|e&~t)+l[10]+38016083|0,o=(o<<9|o>>>23)+a|0,t+=(o&e|a&~e)+l[15]-660478335|0,t=(t<<14|t>>>18)+o|0,e+=(t&a|o&~a)+l[4]-405537848|0,e=(e<<20|e>>>12)+t|0,a+=(e&o|t&~o)+l[9]+568446438|0,a=(a<<5|a>>>27)+e|0,o+=(a&t|e&~t)+l[14]-1019803690|0,o=(o<<9|o>>>23)+a|0,t+=(o&e|a&~e)+l[3]-187363961|0,t=(t<<14|t>>>18)+o|0,e+=(t&a|o&~a)+l[8]+1163531501|0,e=(e<<20|e>>>12)+t|0,a+=(e&o|t&~o)+l[13]-1444681467|0,a=(a<<5|a>>>27)+e|0,o+=(a&t|e&~t)+l[2]-51403784|0,o=(o<<9|o>>>23)+a|0,t+=(o&e|a&~e)+l[7]+1735328473|0,t=(t<<14|t>>>18)+o|0,e+=(t&a|o&~a)+l[12]-1926607734|0,e=(e<<20|e>>>12)+t|0,a+=(e^t^o)+l[5]-378558|0,a=(a<<4|a>>>28)+e|0,o+=(a^e^t)+l[8]-2022574463|0,o=(o<<11|o>>>21)+a|0,t+=(o^a^e)+l[11]+1839030562|0,t=(t<<16|t>>>16)+o|0,e+=(t^o^a)+l[14]-35309556|0,e=(e<<23|e>>>9)+t|0,a+=(e^t^o)+l[1]-1530992060|0,a=(a<<4|a>>>28)+e|0,o+=(a^e^t)+l[4]+1272893353|0,o=(o<<11|o>>>21)+a|0,t+=(o^a^e)+l[7]-155497632|0,t=(t<<16|t>>>16)+o|0,e+=(t^o^a)+l[10]-1094730640|0,e=(e<<23|e>>>9)+t|0,a+=(e^t^o)+l[13]+681279174|0,a=(a<<4|a>>>28)+e|0,o+=(a^e^t)+l[0]-358537222|0,o=(o<<11|o>>>21)+a|0,t+=(o^a^e)+l[3]-722521979|0,t=(t<<16|t>>>16)+o|0,e+=(t^o^a)+l[6]+76029189|0,e=(e<<23|e>>>9)+t|0,a+=(e^t^o)+l[9]-640364487|0,a=(a<<4|a>>>28)+e|0,o+=(a^e^t)+l[12]-421815835|0,o=(o<<11|o>>>21)+a|0,t+=(o^a^e)+l[15]+530742520|0,t=(t<<16|t>>>16)+o|0,e+=(t^o^a)+l[2]-995338651|0,e=(e<<23|e>>>9)+t|0,a+=(t^(e|~o))+l[0]-198630844|0,a=(a<<6|a>>>26)+e|0,o+=(e^(a|~t))+l[7]+1126891415|0,o=(o<<10|o>>>22)+a|0,t+=(a^(o|~e))+l[14]-1416354905|0,t=(t<<15|t>>>17)+o|0,e+=(o^(t|~a))+l[5]-57434055|0,e=(e<<21|e>>>11)+t|0,a+=(t^(e|~o))+l[12]+1700485571|0,a=(a<<6|a>>>26)+e|0,o+=(e^(a|~t))+l[3]-1894986606|0,o=(o<<10|o>>>22)+a|0,t+=(a^(o|~e))+l[10]-1051523|0,t=(t<<15|t>>>17)+o|0,e+=(o^(t|~a))+l[1]-2054922799|0,e=(e<<21|e>>>11)+t|0,a+=(t^(e|~o))+l[8]+1873313359|0,a=(a<<6|a>>>26)+e|0,o+=(e^(a|~t))+l[15]-30611744|0,o=(o<<10|o>>>22)+a|0,t+=(a^(o|~e))+l[6]-1560198380|0,t=(t<<15|t>>>17)+o|0,e+=(o^(t|~a))+l[13]+1309151649|0,e=(e<<21|e>>>11)+t|0,a+=(t^(e|~o))+l[4]-145523070|0,a=(a<<6|a>>>26)+e|0,o+=(e^(a|~t))+l[11]-1120210379|0,o=(o<<10|o>>>22)+a|0,t+=(a^(o|~e))+l[2]+718787259|0,t=(t<<15|t>>>17)+o|0,e+=(o^(t|~a))+l[9]-343485551|0,e=(e<<21|e>>>11)+t|0,n[0]=a+n[0]|0,n[1]=e+n[1]|0,n[2]=t+n[2]|0,n[3]=o+n[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(u.stateIdentity),this}appendStr(n){const l=this._buffer8,a=this._buffer32;let e=this._bufferLength,t,o;for(o=0;o<n.length;o+=1){if(t=n.charCodeAt(o),t<128)l[e++]=t;else if(t<2048)l[e++]=(t>>>6)+192,l[e++]=t&63|128;else if(t<55296||t>56319)l[e++]=(t>>>12)+224,l[e++]=t>>>6&63|128,l[e++]=t&63|128;else{if(t=(t-55296)*1024+(n.charCodeAt(++o)-56320)+65536,t>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");l[e++]=(t>>>18)+240,l[e++]=t>>>12&63|128,l[e++]=t>>>6&63|128,l[e++]=t&63|128}e>=64&&(this._dataLength+=64,u._md5cycle(this._state,a),e-=64,a[0]=a[16])}return this._bufferLength=e,this}appendAsciiStr(n){const l=this._buffer8,a=this._buffer32;let e=this._bufferLength,t,o=0;for(;;){for(t=Math.min(n.length-o,64-e);t--;)l[e++]=n.charCodeAt(o++);if(e<64)break;this._dataLength+=64,u._md5cycle(this._state,a),e=0}return this._bufferLength=e,this}appendByteArray(n){const l=this._buffer8,a=this._buffer32;let e=this._bufferLength,t,o=0;for(;;){for(t=Math.min(n.length-o,64-e);t--;)l[e++]=n[o++];if(e<64)break;this._dataLength+=64,u._md5cycle(this._state,a),e=0}return this._bufferLength=e,this}getState(){const n=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[n[0],n[1],n[2],n[3]]}}setState(n){const l=n.buffer,a=n.state,e=this._state;let t;for(this._dataLength=n.length,this._bufferLength=n.buflen,e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],t=0;t<l.length;t+=1)this._buffer8[t]=l.charCodeAt(t)}end(n=!1){const l=this._bufferLength,a=this._buffer8,e=this._buffer32,t=(l>>2)+1;this._dataLength+=l;const o=this._dataLength*8;if(a[l]=128,a[l+1]=a[l+2]=a[l+3]=0,e.set(u.buffer32Identity.subarray(t),t),l>55&&(u._md5cycle(this._state,e),e.set(u.buffer32Identity)),o<=4294967295)e[14]=o;else{const h=o.toString(16).match(/(.*?)(.{0,8})$/);if(h===null)return;const f=parseInt(h[2],16),m=parseInt(h[1],16)||0;e[14]=f,e[15]=m}return u._md5cycle(this._state,e),n?this._state:u._hex(this._state)}}u.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);u.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);u.hexChars="0123456789abcdef";u.hexOut=[];u.onePassHasher=new u;if(u.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");const z=T({name:"Upload",components:{uploadIcon:x,Hide:B,View:H},data(){return{metaData:[{category:"",id:"",title:"",time:"",wordCount:0,description:""}],sha:"",title:"",newCategory:"",content:"",description:"",token:"",categoryType:null,isNewBlog:null,isUpdating:!1,markDownRender:new j({html:!0,linkify:!0,typographer:!0})}},methods:{async upload(){this.isUpdating=!0;let s="";const n=new u().appendStr(this.newCategory+this.title).end();let l=this.metaData.find(a=>a.id===n);l!==void 0&&(this.metaData.splice(this.metaData.indexOf(l),1),await U({owner:"HanG-0",repo:"blogData",path:`blogs/${this.newCategory}/${this.title}.txt`}).then(a=>{s=a.data.sha}).catch(a=>{console.log("获取sha失败"+a)})),this.metaData.push({id:n,title:this.title,time:new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),wordCount:this.content.length,category:this.newCategory,description:this.description}),await I({owner:"HanG-0",repo:"blogData",path:"data.json",sha:this.sha,message:`upload with title: ${this.title} at ${new Date().toLocaleDateString("zh-CN")},category:${this.newCategory}`,content:btoa(encodeURIComponent(JSON.stringify(this.metaData)))},this.token),I({owner:"HanG-0",repo:"blogData",path:`blogs/${this.newCategory}/${this.title}.txt`,message:`upload with title: ${this.title} at ${new Date().toLocaleDateString("zh-CN")},category:${this.newCategory}`,content:btoa(encodeURIComponent(this.content)),sha:s},this.token).then(a=>{this.isUpdating=!1,this.loadedMessage("内容上传完毕",a.status),this.$router.push({name:"SE"})}).catch(a=>{this.isUpdating=!1,console.log("内容上传:"+a),this.loadedMessage("内容上传失败",a.status)})},loadedMessage(s,n){R({message:n===200||n==201?"upload successfully":`upload failed : ${s}-${n}`,type:n===200||n===201?"success":"error",duration:2e3,center:!0})},updateContent(){const s=this.$refs.divText;this.content=s.innerText}},computed:{marked(){return this.markDownRender.render(this.content)},getCategories(){return this.metaData.map(s=>s.category)},getTitleForCategory(){return this.metaData.filter(s=>s.category===this.newCategory).map(s=>s.title)}},mounted(){U({owner:"HanG-0",repo:"blogData",path:"data.json"}).then(s=>{this.metaData=JSON.parse(decodeURIComponent(atob(s.data.content))),this.sha=s.data.sha}).catch(s=>{console.log(s)})}}),O={class:"form",ref:"form",style:{display:"inline-block",float:"left",width:"52%","margin-left":"0","margin-bottom":"20px"}},G={style:{width:"100%"}},P=["innerHTML"];function J(s,n,l,a,e,t){const o=p("el-radio"),h=p("el-radio-group"),f=p("el-form-item"),m=p("el-input"),V=p("el-option"),F=p("el-select"),S=p("uploadIcon"),$=p("el-icon"),v=p("el-button"),L=p("el-form"),A=p("el-collapse-item"),N=p("el-collapse");return c(),_(C,null,[w("div",O,[i(N,{style:{}},{default:d(()=>[i(A,{title:"EditDetails",style:{}},{default:d(()=>[i(L,{"label-width":"auto",style:{"max-width":"90%"}},{default:d(()=>[i(f,{label:" "},{default:d(()=>[i(h,{modelValue:s.categoryType,"onUpdate:modelValue":n[0]||(n[0]=r=>s.categoryType=r)},{default:d(()=>[i(o,{value:!0},{default:d(()=>[y("New category")]),_:1}),i(o,{value:!1},{default:d(()=>[y("select from existing categories")]),_:1})]),_:1},8,["modelValue"])]),_:1}),s.categoryType?(c(),g(f,{key:0,label:"Categories"},{default:d(()=>[i(m,{modelValue:s.newCategory,"onUpdate:modelValue":n[1]||(n[1]=r=>s.newCategory=r),style:{width:"90%"},placeholder:"input your new category",clearable:""},null,8,["modelValue"])]),_:1})):b("",!0),s.categoryType?b("",!0):(c(),g(f,{key:1,label:"Categories"},{default:d(()=>[i(F,{modelValue:s.newCategory,"onUpdate:modelValue":n[2]||(n[2]=r=>s.newCategory=r),style:{width:"90%"},placeholder:"choose a category"},{default:d(()=>[(c(!0),_(C,null,D(s.getCategories,r=>(c(),g(V,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),i(f,{label:" "},{default:d(()=>[i(h,{modelValue:s.isNewBlog,"onUpdate:modelValue":n[3]||(n[3]=r=>s.isNewBlog=r)},{default:d(()=>[i(o,{value:!0},{default:d(()=>[y("New blog ")]),_:1}),i(o,{value:!1},{default:d(()=>[y("Modify existing blog")]),_:1})]),_:1},8,["modelValue"])]),_:1}),s.isNewBlog?(c(),g(f,{key:2,label:"Title"},{default:d(()=>[i(m,{modelValue:s.title,"onUpdate:modelValue":n[4]||(n[4]=r=>s.title=r),style:{width:"90%"},placeholder:"please input your title"},null,8,["modelValue"])]),_:1})):b("",!0),s.isNewBlog?b("",!0):(c(),g(f,{key:3,label:"Title"},{default:d(()=>[i(F,{modelValue:s.title,"onUpdate:modelValue":n[5]||(n[5]=r=>s.title=r),style:{width:"90%"},placeholder:"choose an existing title"},{default:d(()=>[(c(!0),_(C,null,D(s.getTitleForCategory,r=>(c(),g(V,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),i(f,{label:"token"},{default:d(()=>[i(m,{placeholder:"input the token",modelValue:s.token,"onUpdate:modelValue":n[6]||(n[6]=r=>s.token=r),style:{width:"90%"}},null,8,["modelValue"])]),_:1}),i(f,{label:"Description"},{default:d(()=>[i(m,{type:"textarea",style:{},modelValue:s.description,"onUpdate:modelValue":n[7]||(n[7]=r=>s.description=r),autosize:{minRows:4}},null,8,["modelValue"])]),_:1}),w("div",G,[i(f,{label:"Upload"},{default:d(()=>[i(v,{id:"submit",type:"primary",style:{"margin-left":"30%"},onClick:s.upload,loading:s.isUpdating},{default:d(()=>[y(" Upload "),i($,{class:"el-icon--right"},{default:d(()=>[i(S)]),_:1})]),_:1},8,["onClick","loading"])]),_:1})])]),_:1})]),_:1})]),_:1}),i(L,{class:"content","label-width":"auto",style:{}},{default:d(()=>[i(f,null,{default:d(()=>[i(m,{type:"textarea",autosize:{minRows:40},modelValue:s.content,"onUpdate:modelValue":n[8]||(n[8]=r=>s.content=r)},null,8,["modelValue"])]),_:1})]),_:1})],512),w("div",{class:"renderResult",innerHTML:s.marked},null,8,P)],64)}const Q=E(z,[["render",J],["__scopeId","data-v-84351e20"]]);export{Q as default};
